
# Функциональное программирование 2024/2025

**ФИО**: Зарипова Динара Ильдаровна  
**Группа**: 11-105

## Описание

Этот проект реализует язык программирования **Colon**, основанный на функциональном программировании, с использованием языка Haskell. Основные компоненты программы включают интерпретатор, парсер, семантические проверки и тесты. В проекте реализованы различные языковые конструкции, такие как арифметика, циклы, условия, ввод/вывод, и манипуляции со стеком.

## Расширения Haskell

В проекте используются следующие расширения языка Haskell:

- `GHC2024`: для использования полезных расширений, таких как:
    - `DeriveGeneric`, `DerivingStrategies`, `GeneralisedNewtypeDeriving` — для удобной работы с типами.
    - `ImportQualifiedPost`, `NamedFieldPuns`, `TypeApplications` — для улучшения читаемости и синтаксической красоты.
    - `BlockArguments`, `DeriveAnyClass`, `LexicalNegation` — для упрощения записи и сокращения кода.
    - `MonadComprehensions`, `DuplicateRecordFields`, `RecordWildCards` — для улучшения работы с монадами и рекордами.
    - `MultiWayIf`, `OverloadedRecordDot` — для удобной работы с условиями и рекордами.

## Библиотеки

Проект использует следующие библиотеки:

- `containers` — для работы с коллекциями данных, такими как `Map` и `Set`.
- `transformers` — для композиции типов, которые описывают вычисления с эффектами.
- `mtl` — для удобной работы с эффектами и лифтирования действий в стек трансформеров.
- `megaparsec` — для создания парсеров и разбора исходного кода.
- `hspec` — для описания тестов и проверки корректности работы программы.
- `QuickCheck` — для проп-тестирования свойств.
- `deepseq` — для проверки вычислений в нормальной форме.
- `filepath` — для работы с путями файлов.

## Основные принципы

### Типы команд, результаты и ошибки

Для команд был выбран древовидный тип, чтобы отражать структуру команд с вложенностью, особенно для конструкций типа `DoLoop`, `IfThenElse`, и `WordDefinition`. Пример типа для имени слова: `WordName` — это просто `String`.

Каждая команда возвращает новое состояние интерпретатора или ошибку. Значения в языке представлены типом `Int`, так как только числа могут быть на стеке.

### Стек значений

Стек значений представлен как список, что обеспечивает иммутабельность и эффективное добавление/удаление элементов. Встроенные слова, такие как арифметические операции, управляют стеком с помощью команд типа `pushInt` и `popInt`.

### Сравнения и логика

Для выполнения сравнений используются хелперы `popBool` и `pushBool`, которые конвертируют значения на стеке в булевы значения (0 — False, все остальные значения — True).

### Условные операторы и циклы

Циклы и условные операторы реализованы с использованием стеков фреймов и простых проверок условий. При входе в цикл на стек добавляется фрейм с индексом и пределом.

### Ввод/вывод

Для ввода используется ленивое Haskell IO с помощью функции `getContents`, что позволяет получать ввод по мере его поступления. Вывод осуществляется через буфер, добавляя символы в начало для оптимизации.

### Строки и комментарии

Для строк используется парсер, который читает символы до закрывающей кавычки. Для комментариев применяются встроенные функции парсера `megaparsec`.

## Тестирование

### Тесты

Тестирование выполняется с использованием библиотеки `hspec`. Включены следующие типы тестов:

- **Примеры** — тесты с конкретными примерами, которые проверяют выполнение различных операций (арифметика, ввод/вывод, условные операторы).
- **Тесты-файлы** — тесты, основанные на чтении исходных файлов, которые содержат код программы, её вывод и ввод (если он требуется).
- **Property-тесты** — проп-тесты, которые проверяют свойства программы, такие как ассоциативность и тотальность исполнения.

### Пример теста

Пример теста с использованием DSL для проверки выводов программы:

```haskell
example "<source code>" 
esult -> do
  <result assertions>
```

### Запуск тестов

Для запуска тестов в проекте используется команда:

```bash
cabal test
```

### Пример результата

После выполнения тестов выводится информация о прошедших тестах:

```powershell
Build profile: -w ghc-9.10.1 -O1
Running test suite...
Test suite colon-test: RUNNING...

Language.Colon.Semantic
  Examples
    Arithmetic
      1 2 3 + [v]
      1 2 3 + + [v]
      1 2 3 + + + [v]
      ...
    Loops
      5 0 DO I LOOP [v]
      examples\multiplication-table.colon [v]
  Finished in 1.0149 seconds
  46 examples, 0 failures
```

## Запуск программы

Для запуска программы, выполните следующие шаги в **PowerShell**:

1. Перейдите в каталог сборки:

    ```powershell
    cd C:\path\to\project
    ```

2. Запустите тесты:

    ```powershell
    cabal test
    ```

Результаты тестов будут выведены в консоль, и вы сможете видеть, прошли ли все тесты или были ошибки.

---

Этот проект демонстрирует основы функционального программирования на примере языка, подобного Forth, с поддержкой арифметики, условных операторов, циклов, ввода/вывода и манипуляций со стеком.

## Следующий этап

- массивы (2)
- конструкция `case of` / `endcase` (3)
- многократные выходы из циклов (4)
- компиляция (8)
